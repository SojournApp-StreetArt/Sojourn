{"version":3,"sources":["webpack:///./src/hooks/firebase-file-upload.ts","webpack:///./src/views/Home.vue?0e2e","webpack:///./src/views/Home.vue","webpack:///./src/views/Home.vue?d5e7","webpack:///./src/views/Home.vue?ab8c"],"names":["apps","length","initializeApp","STORAGE_FILE_PATH","progress","files","state","error","loading","resultData","storageRef","storage","ref","deleteFile","path","delete","listFiles","value","listAll","then","r","console","log","items","forEach","e","fullPath","getDownloadURL","url","push","name","uploadData","fileData","Promise","resolve","reject","uniquePathName","Date","getTime","child","uploadTask","putString","contentType","on","TaskEvent","STATE_CHANGED","_progress","prog","bytesTransferred","totalBytes","_error","snapshot","downloadUrl","metadata","image","size","timeCreated","class","translucent","fullscreen","style","progressBarStyleCalc","imageUrl","src","dataUrl","slot","takePicture","uploadImage","Camera","components","IonCard","IonCardContent","IonCardHeader","IonContent","IonHeader","IonPage","IonTitle","IonToolbar","IonButton","setup","handleToast","message","isError","create","position","color","duration","t","present","width","height","format","getPhoto","quality","allowEditing","resultType","DataUrl","source","Prompt","render","__scopeId"],"mappings":"kRAS6B,IAAzB,IAASA,KAAKC,QAChB,IAASC,cAAc,QAGzB,IAAMC,EAAoB,iBAuBZ,kBACZ,IAAMC,EAAW,eAAY,GACvBC,EAAQ,iBACRC,EAAQ,eAAiB,CAE7BC,MAAO,KAEPC,SAAS,EAETC,WAAY,OAIRC,EAAa,IAASC,UAAUC,MAMhCC,EAAU,yDAAG,WAAOC,GAAP,0GACV,IACJH,UACAC,IAAIE,GACJC,UAJc,2CAAH,sDAUVC,EAAY,WAEhB,OADAX,EAAMY,MAAQ,GACP,IACJN,UACAC,IAAI,kBACJM,UACAC,MAAK,SAACC,GAQL,OAPAC,QAAQC,IAAIF,GACZA,EAAEG,MAAMC,QAAR,yDAAgB,WAAOC,GAAP,gGACdJ,QAAQC,IAAIG,EAAEC,UADA,SAEID,EAAEE,iBAFN,OAERC,EAFQ,OAGT,OAALvB,QAAK,IAALA,GAAA,UAAAA,EAAOY,aAAP,SAAcY,KAAK,CAAEC,KAAML,EAAEC,SAAUE,QAHzB,2CAAhB,uDAMOvB,EAAMY,UASbc,EAAa,SACjBC,EACAF,GAEA,OAAO,IAAIG,SAAQ,SAACC,EAASC,GAE3B7B,EAAMC,MAAQ,KACdD,EAAME,SAAU,EAEhBJ,EAASa,MAAQ,EAEjB,IAAMmB,GAAiB,IAAIC,MAAOC,UAAY,IAAMR,EAEpD,IACE,IAAM,EAAMpB,EAAW6B,MAAX,UAAoBpC,EAApB,aAA0CiC,IAChDI,EAAa,EAAIC,UAAUT,EAAU,WAAY,CACrDU,YAAa,eAIfF,EAAWG,GACT,IAAShC,QAAQiC,UAAUC,eAC3B,SAACC,GACC,IAAMC,EAAOD,EAAUE,iBAAmBF,EAAUG,WACpD7C,EAASa,MAAQ8B,EACjB1B,QAAQC,IAAI,gBAAiByB,MAE/B,SAACG,GAIC,OAHA5C,EAAMC,MAAQ2C,EACd5C,EAAME,SAAU,EAChBa,QAAQC,IAAI,QAAS4B,GACdf,EAAO7B,EAAMC,SAXxB,wCAcE,2GACED,EAAMC,MAAQ,KACdD,EAAME,SAAU,EAFlB,SAI4BgC,EAAWW,SAASvC,IAAIe,iBAJpD,cAIQyB,EAJR,OAKE9C,EAAMG,WAAa,CACjB2C,cACAtB,KAAMU,EAAWW,SAASE,SAASvB,KACnCwB,MAAO,CACL1C,IAAK4B,EAAWW,SAASvC,IAAIc,SAC7B6B,KAAMf,EAAWW,SAASE,SAASE,KACnCb,YAAaF,EAAWW,SAASE,SAASX,YAC1Cc,YAAahB,EAAWW,SAASE,SAASG,cAI9CpD,EAASa,MAAQ,EAhBnB,kBAkBSiB,EAAQ5B,EAAMG,aAlBvB,4CAqBF,MAAOyC,GAIP,OAHA5C,EAAME,SAAU,EAChBF,EAAMC,MAAQ2C,EACd9C,EAASa,MAAQ,EACVkB,EAAO7B,EAAMC,YAW1B,OAJA,wCAAC,8GACOS,IADP,0CAAD,GAIA,iCACK,eAAOV,IADZ,IAEEF,WACA2B,aACAf,YACAH,aACAR,Y,kCCpKJ,W,oJCImB,S,sBAaT,eAAgC,UAA5B,2BAAuB,G,EAG3B,eAAkH,WAA7G,2GAAuG,G,SACvFoD,MAAM,iB,iBAKuB,oB,iBACF,U,2WA1BxD,eA+BW,Q,WA9BT,iBAIa,CAJb,eAIa,GAJAC,aAAa,GAAI,C,WAC5B,iBAEc,CAFd,eAEc,Q,WADZ,iBAA4B,CAA5B,eAA4B,Q,WAAjB,iBAAK,C,gCAIpB,eAuBc,GAvBAC,YAAY,EAAMF,MAAM,e,YACpC,iBAGM,CAHK,EAAAjD,S,iBAAX,eAGM,SADJ,eAAyC,OAAnCoD,MAAO,EAAAC,sBAAoB,WAEnB,EAAAtD,O,iBAAhB,eAAsC,uBAAb,EAAAA,OAAK,I,sBAE9B,eAeW,Q,WAdT,iBAEkB,CAFlB,eAEkB,Q,WADhB,iBAAgC,CAAhC,M,MAEF,eAUmB,Q,WATjB,iBAAkH,CAAlH,EACW,EAAAuD,U,iBAAX,eAEM,MAFN,EAEM,CADJ,eAAiD,OAA3CC,IAAK,EAAAD,SAAW,EAAAA,SAASE,QAAO,M,yCAGxC,eAGc,Q,WAFZ,iBAA6E,CAA7E,eAA6E,GAAjEC,KAAK,QAAS,QAAK,+BAAE,EAAAC,iB,YAAe,iBAAgB,C,YAChE,eAAiE,GAArDD,KAAK,MAAO,QAAK,+BAAE,EAAAE,iB,YAAe,iBAAM,C,6HCPxDC,EAAW,OAAXA,OAMO,iBAAgB,CAC7BtC,KAAM,OACNuC,WAAY,CACVC,QAAA,OACAC,eAAA,OACAC,cAAA,OACAC,WAAA,OACAC,UAAA,OACAC,QAAA,OACAC,SAAA,OACAC,WAAA,OACAC,UAAA,QAEFC,MAb6B,WAaxB,MAOC,iBALFhD,EAFC,EAEDA,WACAvB,EAHC,EAGDA,QACAJ,EAJC,EAIDA,SACAG,EALC,EAKDA,MACAE,EANC,EAMDA,WAGIqD,EAAW,iBAKXkB,EAAc,SAACC,GAAoC,IAAnBC,EAAmB,wDACvD,OACGC,OAAO,CACNF,QAASA,EACTG,SAAU,MACVC,MAAOH,EAAU,SAAW,UAC5BI,SAAU,MAEXnE,MAAK,SAACoE,GAAD,OAAOA,EAAEC,cAOb3B,EAAuB,gBAAS,WACpC,MAAO,CACL4B,MAAwB,IAAjBrF,EAASa,MAAc,IAC9B,mBAAoB,MACpByE,OAAQ,UAQNvB,EAAW,yDAAG,0HACbL,QADa,IACbA,OADa,EACbA,EAAU7C,MADG,iEAIVa,GAAO,IAAIO,MAAOC,UAAY,IAAMwB,EAAS7C,MAAM0E,OAJzC,SAKsB7B,QALtB,IAKsBA,OALtB,EAKsBA,EAAU7C,MALhC,IAKR+C,eALQ,MAKE,GALF,MAKMlD,YALN,MAKagB,EALb,WAOAC,EAAWiC,EAASlD,GAPpB,cAOVM,EAPU,OAQhBC,QAAQC,IAAIF,GAEZ4D,EAAY,mBAAmB,GAC/BlB,EAAS7C,MAAQ,KAXD,kBAaTG,GAbS,qCAehBC,QAAQC,IAAR,MACA0D,EAAY,KAAMC,SAAS,GAhBX,0DAAH,qDAuBXf,EAAW,yDAAG,6HAGIE,EAAOwB,SAAS,CAClCC,QAAS,IACTC,cAAc,EACdC,WAAY,OAAiBC,QAC7BC,OAAQ,OAAaC,SAPP,cAGV5C,EAHU,OAYhBQ,EAAS7C,MAAQqC,EAZD,kBAaTA,GAbS,0CAehB0B,EAAY,mBAAmB,GAff,iFAAH,qDAoBjB,MAAO,CAELd,cACAC,cACApC,aAGA+B,WACAtD,UACAJ,WACAG,QACAE,aACAoD,2B,UClIN,EAAOsC,OAAS,EAChB,EAAOC,UAAY,kBAEJ","file":"js/chunk-c15ba57a.290522f7.js","sourcesContent":["import { toRefs, reactive, ref } from \"vue\";\nimport firebase from \"firebase\";\n// Required for side-effects\nimport \"firebase/firestore\";\n\nimport FIREBASE_CONFIG from \"./.env.firebase\";\n\n// initialize firebase, this is directly from the firebase documentation\n// regarding getting started for the web\nif (firebase.apps.length === 0) {\n  firebase.initializeApp(FIREBASE_CONFIG);\n}\n\nconst STORAGE_FILE_PATH = \"image-capture/\";\n\ntype TFilesArray = {\n  name: string;\n  url: string;\n};\n\ntype TState = {\n  error: Error | null;\n  loading: boolean;\n  resultData: TUploadResultData | null | undefined;\n};\ntype TUploadResultData = {\n  downloadUrl: string;\n  name: string;\n  image: {\n    ref: string;\n    size: number;\n    contentType: string | null | undefined;\n    timeCreated: string;\n  };\n};\n\nexport default function() {\n  const progress = ref<number>(0);\n  const files = ref<Array<TFilesArray> | null | undefined>();\n  const state = reactive<TState>({\n    // error if one happens\n    error: null,\n    // if the query is loading or not\n    loading: false,\n    // result from upload\n    resultData: null,\n  });\n\n  // get the database storage\n  const storageRef = firebase.storage().ref();\n\n  /**\n   * \n   * @param path \n   */\n  const deleteFile = async (path: string) => {\n    return firebase\n      .storage()\n      .ref(path)\n      .delete();\n  };\n  /**\n   * call this function to get the list of files\n   * is the storage bucket\n   */\n  const listFiles = () => {\n    files.value = [];\n    return firebase\n      .storage()\n      .ref(\"image-capture/\")\n      .listAll()\n      .then((r: firebase.storage.ListResult) => {\n        console.log(r);\n        r.items.forEach(async (e: firebase.storage.Reference) => {\n          console.log(e.fullPath);\n          const url = await e.getDownloadURL();\n          files?.value?.push({ name: e.fullPath, url });\n        });\n\n        return files.value;\n      });\n  };\n\n  /**\n   *\n   * @param fileData\n   * @param name\n   */\n  const uploadData = (\n    fileData: string,\n    name?: string\n  ): Promise<TUploadResultData | Error | undefined> => {\n    return new Promise((resolve, reject) => {\n      // initialize upload information\n      state.error = null;\n      state.loading = true;\n\n      progress.value = 0;\n      // ensure unique file names\n      const uniquePathName = new Date().getTime() + \"-\" + name;\n\n      try {\n        const ref = storageRef.child(`${STORAGE_FILE_PATH}\\\\${uniquePathName}`);\n        const uploadTask = ref.putString(fileData, \"data_url\", {\n          contentType: \"image/jpeg\",\n        });\n\n        // The first example.\n        uploadTask.on(\n          firebase.storage.TaskEvent.STATE_CHANGED,\n          (_progress) => {\n            const prog = _progress.bytesTransferred / _progress.totalBytes;\n            progress.value = prog;\n            console.log(\"STATE_CHANGED\", prog);\n          },\n          (_error: Error) => {\n            state.error = _error;\n            state.loading = false;\n            console.log(\"ERROR\", _error);\n            return reject(state.error);\n          },\n          // eslint-disable-next-line no-unused-vars\n          async () => {\n            state.error = null;\n            state.loading = false;\n\n            const downloadUrl = await uploadTask.snapshot.ref.getDownloadURL();\n            state.resultData = {\n              downloadUrl,\n              name: uploadTask.snapshot.metadata.name,\n              image: {\n                ref: uploadTask.snapshot.ref.fullPath,\n                size: uploadTask.snapshot.metadata.size,\n                contentType: uploadTask.snapshot.metadata.contentType,\n                timeCreated: uploadTask.snapshot.metadata.timeCreated,\n              },\n            };\n            // set progress back to zero when complete\n            progress.value = 0;\n\n            return resolve(state.resultData);\n          }\n        );\n      } catch (_error) {\n        state.loading = false;\n        state.error = _error;\n        progress.value = 0;\n        return reject(state.error);\n      }\n    });\n  };\n\n  // this call is done at startup to get the initial\n  // list of files\n  (async () => {\n    await listFiles();\n  })();\n\n  return {\n    ...toRefs(state),\n    progress,\n    uploadData,\n    listFiles,\n    deleteFile,\n    files,\n  };\n}\n","export { default } from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./Home.vue?vue&type=style&index=0&id=6df759b2&scoped=true&lang=css\"; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./Home.vue?vue&type=style&index=0&id=6df759b2&scoped=true&lang=css\"","<template>\n  <ion-page>\n    <ion-header :translucent=\"true\">\n      <ion-toolbar>\n        <ion-title>Blank</ion-title>\n      </ion-toolbar>\n    </ion-header>\n\n    <ion-content :fullscreen=\"true\" class=\"ion-padding\">\n      <div v-if=\"loading\">\n        <!-- <span>{{progress}}</span> -->\n        <div :style=\"progressBarStyleCalc\"></div>\n      </div>\n      <div v-else-if=\"error\">{{error}}</div>\n\n      <ion-card>\n        <ion-card-header>\n          <h2>This is the Camera Page</h2>\n        </ion-card-header>\n        <ion-card-content>\n          <div>Showing the use of the Capacitor Camera plugin and the vue-router for changing pages in the application</div>\n          <div v-if=\"imageUrl\" class=\"image-wrapper\">\n            <img :src=\"imageUrl ? imageUrl.dataUrl : null\" />\n          </div>\n\n          <ion-toolbar>\n            <ion-button slot=\"start\" @click=\"takePicture()\">Take Picture Now</ion-button>\n            <ion-button slot=\"end\" @click=\"uploadImage()\">UPLOAD</ion-button>\n          </ion-toolbar>\n        </ion-card-content>\n      </ion-card>\n    </ion-content>\n  </ion-page>\n</template>\n\n<script lang=\"ts\">\nimport {\n  IonCard,\n  IonCardContent,\n  IonCardHeader,\n  IonContent,\n  IonHeader,\n  IonPage,\n  IonTitle,\n  IonToolbar,\n  IonButton,\n  toastController,\n} from \"@ionic/vue\";\n\nimport {\n  Plugins,\n  CameraSource,\n  CameraResultType,\n  CameraPhoto,\n} from \"@capacitor/core\";\nconst { Camera } = Plugins;\n\nimport { defineComponent, ref, computed } from \"vue\";\n\nimport useFirebaseFileUpload from \"../hooks/firebase-file-upload\";\n\nexport default defineComponent({\n  name: \"Home\",\n  components: {\n    IonCard,\n    IonCardContent,\n    IonCardHeader,\n    IonContent,\n    IonHeader,\n    IonPage,\n    IonTitle,\n    IonToolbar,\n    IonButton,\n  },\n  setup() {\n    const {\n      uploadData,\n      loading,\n      progress,\n      error,\n      resultData,\n    } = useFirebaseFileUpload();\n\n    const imageUrl = ref<CameraPhoto | null>();\n\n    /**\n     *\n     */\n    const handleToast = (message: string, isError = false) => {\n      toastController\n        .create({\n          message: message,\n          position: \"top\",\n          color: isError ? \"danger\" : \"primary\",\n          duration: 2000,\n        })\n        .then((t) => t.present());\n    };\n\n    /**\n     * used to calculate the progress bar when\n     * uploading the file\n     */\n    const progressBarStyleCalc = computed(() => {\n      return {\n        width: progress.value * 100 + \"%\",\n        \"background-color\": \"red\",\n        height: \"4px\",\n      };\n    });\n\n    /**\n     * tries to upload the image to firebase using\n     * the composition api function uploadData\n     */\n    const uploadImage = async () => {\n      if (!imageUrl?.value) return;\n\n      try {\n        const name = new Date().getTime() + \".\" + imageUrl.value.format;\n        const { dataUrl = \"\", path = name } = imageUrl?.value;\n\n        const r = await uploadData(dataUrl, path);\n        console.log(r);\n\n        handleToast(\"File Uploaded!!\", false);\n        imageUrl.value = null;\n        \n        return r;\n      } catch (error) {\n        console.log(error);\n        handleToast(error.message, true);\n      }\n    };\n\n    /**\n     * takes the picture, return CameraPhoto | Error\n     */\n    const takePicture = async (): Promise<CameraPhoto | Error> => {\n      // Otherwise, make the call:\n      try {\n        const image = await Camera.getPhoto({\n          quality: 100,\n          allowEditing: true,\n          resultType: CameraResultType.DataUrl,\n          source: CameraSource.Prompt,\n        });\n\n        // image.base64_data will contain the base64 encoded result as\n        // a JPEG, with the data-uri prefix added\n        imageUrl.value = image;\n        return image;\n      } catch (e) {\n        handleToast(\"User Cancelled!\", true);\n        return e;\n      }\n    };\n\n    return {\n      // functions\n      takePicture,\n      uploadImage,\n      uploadData,\n\n      // properties\n      imageUrl,\n      loading,\n      progress,\n      error,\n      resultData,\n      progressBarStyleCalc,\n    };\n  },\n});\n</script>\n\n<style scoped>\n.image-wrapper {\n  text-align: center;\n  height: 210px;\n  padding: 6px;\n  background: whitesmoke;\n}\nimg {\n  object-fit: contain;\n  height: 200px !important;\n}\n</style>","\nimport {\n  IonCard,\n  IonCardContent,\n  IonCardHeader,\n  IonContent,\n  IonHeader,\n  IonPage,\n  IonTitle,\n  IonToolbar,\n  IonButton,\n  toastController,\n} from \"@ionic/vue\";\n\nimport {\n  Plugins,\n  CameraSource,\n  CameraResultType,\n  CameraPhoto,\n} from \"@capacitor/core\";\nconst { Camera } = Plugins;\n\nimport { defineComponent, ref, computed } from \"vue\";\n\nimport useFirebaseFileUpload from \"../hooks/firebase-file-upload\";\n\nexport default defineComponent({\n  name: \"Home\",\n  components: {\n    IonCard,\n    IonCardContent,\n    IonCardHeader,\n    IonContent,\n    IonHeader,\n    IonPage,\n    IonTitle,\n    IonToolbar,\n    IonButton,\n  },\n  setup() {\n    const {\n      uploadData,\n      loading,\n      progress,\n      error,\n      resultData,\n    } = useFirebaseFileUpload();\n\n    const imageUrl = ref<CameraPhoto | null>();\n\n    /**\n     *\n     */\n    const handleToast = (message: string, isError = false) => {\n      toastController\n        .create({\n          message: message,\n          position: \"top\",\n          color: isError ? \"danger\" : \"primary\",\n          duration: 2000,\n        })\n        .then((t) => t.present());\n    };\n\n    /**\n     * used to calculate the progress bar when\n     * uploading the file\n     */\n    const progressBarStyleCalc = computed(() => {\n      return {\n        width: progress.value * 100 + \"%\",\n        \"background-color\": \"red\",\n        height: \"4px\",\n      };\n    });\n\n    /**\n     * tries to upload the image to firebase using\n     * the composition api function uploadData\n     */\n    const uploadImage = async () => {\n      if (!imageUrl?.value) return;\n\n      try {\n        const name = new Date().getTime() + \".\" + imageUrl.value.format;\n        const { dataUrl = \"\", path = name } = imageUrl?.value;\n\n        const r = await uploadData(dataUrl, path);\n        console.log(r);\n\n        handleToast(\"File Uploaded!!\", false);\n        imageUrl.value = null;\n        \n        return r;\n      } catch (error) {\n        console.log(error);\n        handleToast(error.message, true);\n      }\n    };\n\n    /**\n     * takes the picture, return CameraPhoto | Error\n     */\n    const takePicture = async (): Promise<CameraPhoto | Error> => {\n      // Otherwise, make the call:\n      try {\n        const image = await Camera.getPhoto({\n          quality: 100,\n          allowEditing: true,\n          resultType: CameraResultType.DataUrl,\n          source: CameraSource.Prompt,\n        });\n\n        // image.base64_data will contain the base64 encoded result as\n        // a JPEG, with the data-uri prefix added\n        imageUrl.value = image;\n        return image;\n      } catch (e) {\n        handleToast(\"User Cancelled!\", true);\n        return e;\n      }\n    };\n\n    return {\n      // functions\n      takePicture,\n      uploadImage,\n      uploadData,\n\n      // properties\n      imageUrl,\n      loading,\n      progress,\n      error,\n      resultData,\n      progressBarStyleCalc,\n    };\n  },\n});\n","import { render } from \"./Home.vue?vue&type=template&id=6df759b2&scoped=true&bindings={}\"\nimport script from \"./Home.vue?vue&type=script&lang=ts\"\nexport * from \"./Home.vue?vue&type=script&lang=ts\"\n\nimport \"./Home.vue?vue&type=style&index=0&id=6df759b2&scoped=true&lang=css\"\nscript.render = render\nscript.__scopeId = \"data-v-6df759b2\"\n\nexport default script"],"sourceRoot":""}